const ROW_SELECTOR="tr:nth-child(n+2):not(table table tr)";let settings,whiteElements,blackElements,defaults={indicatorAsc:"ᐃ",indicatorDsc:"ᐁ",sortHint:"Sort the table by clicking on a column heading.",restoreHint:"Restore the original order by clicking <button>Restore Order</button>.",whiteList:"",blackList:""};function getArray(e){return e&&"string"==typeof e||e instanceof String?e.split(","):e||[]}function isWhitelisted(e){return!whiteElements.size||whiteElements.has(e)}function isBlacklisted(e){return!!e.classList.contains("no-so")||blackElements.has(e)}function setConfig(e){settings=Object.assign({},defaults,e),whiteElements=new Set,blackElements=new Set;for(let e of getArray(settings.whiteList))for(let t of document.querySelectorAll(e))whiteElements.add(t);for(let e of getArray(settings.blackList))for(let t of document.querySelectorAll(e))blackElements.add(t)}function getIndexedRowValue(e,t){return e.children[t].innerText||e.children[t].textContent}function getColumnIndex(e){return Array.from(e.parentNode.children).indexOf(e)}function getColumn(e,t){return Array.from(e.querySelectorAll("tr")).map(e=>e.children[t])}function canColumnSort(e){return!e.length||"TH"==e[0].tagName}function isTableSorted(e){return e.querySelector(".asc:not(table table asc)")||e.querySelector(".dsc:not(table table dsc)")}function getCellValue(e){return e.innerText||e.textContent}function compareValues(e,t){return isNaN(e)||isNaN(t)?String(e).localeCompare(String(t)):e-t}function isColumnAsc(e){let t=e.filter(e=>"TH"!=e.tagName).map(e=>getCellValue(e)),n=[...t].sort(compareValues);return String(t)==String(n)}function comparer(e,t){return function(n,r){return compareValues(getIndexedRowValue(t?n:r,e),getIndexedRowValue(t?r:n,e))}}function clearTableSortIndication(e){e.querySelectorAll("th.sotable-column:not(table table th)").forEach(e=>{e.classList.remove("asc"),e.classList.remove("dsc"),e.ariaSort=null,e.querySelectorAll(".indicator").forEach(e=>e.remove())})}function indicateColumnSortDirection(e,t,n){clearTableSortIndication(e);let r=document.createElement("span");t.firstChild.appendChild(r),r.classList.add("indicator"),r.ariaHidden=!0,n?(t.classList.add("asc"),t.ariaSort="ascending",r.innerHTML=settings.indicatorAsc):(t.classList.add("dsc"),t.ariaSort="descending",r.innerHTML=settings.indicatorDsc),indicateRestoreTableOrder(e)}function storeOrigTableOrder(e){let t=1;e.querySelectorAll(`${ROW_SELECTOR}:not([orig-order])`).forEach(e=>{e.setAttribute("orig-order",t),t++})}function restoreOrigTableOrder(e){clearTableSortIndication(e),Array.from(e.querySelectorAll(`${ROW_SELECTOR}[orig-order]`)).sort((e,t)=>parseInt(e.getAttribute("orig-order"))-parseInt(t.getAttribute("orig-order"))).forEach(t=>e.appendChild(t))}function indicateRestoreTableOrder(e){e.querySelectorAll("caption p.indicator:not(table table caption p.indicator)").forEach(t=>{!t.querySelector(".restore-hint")&&settings.restoreHint&&(t.innerHTML+=` <span class="restore-hint">${settings.restoreHint}</span>`,t.querySelectorAll(".restore-hint button").forEach(t=>{t.classList.add("restore-order"),t.addEventListener("click",()=>{restoreOrigTableOrder(e)})}))})}function indicateSortableTable(e){let t=e.querySelector("caption");t||(t=document.createElement("caption"),e.prepend(t));let n=e.querySelector("p.indicator");n||((n=document.createElement("p")).classList.add("indicator"),n.innerHTML=settings.sortHint,t.appendChild(n)),indicateRestoreTableOrder(e)}function insertColumnSortToggle(e){return e.querySelectorAll(":not(abbr):not(b):not(br):not(cite):not(code):not(em):not(i):not(img):not(kbd):not(label):not(mark):not(small):not(span):not(strong):not(sub):not(sup):not(svg):not(time)").length?null:(e.innerHTML=`<button>${e.innerHTML}</button>`,e.firstChild)}function sotable(e){setConfig(e),document.querySelectorAll("tr:first-child>th:not(.no-so)").forEach(e=>{let t=e.closest("table");if(!isBlacklisted(t)&&isWhitelisted(t)){let n=getColumnIndex(e);if(canColumnSort(getColumn(t,n))){storeOrigTableOrder(t);let r=insertColumnSortToggle(e);r&&(e.classList.add("sotable-column"),t.classList.add("sotable"),indicateSortableTable(t),r.addEventListener("click",()=>{let r=!isColumnAsc(getColumn(t,n));Array.from(t.querySelectorAll(ROW_SELECTOR)).sort(comparer(getColumnIndex(e),r)).forEach(e=>t.appendChild(e)),indicateColumnSortDirection(t,e,r)}))}}})}function refresh(){sotable(settings)}export default sotable;export{sotable,refresh};